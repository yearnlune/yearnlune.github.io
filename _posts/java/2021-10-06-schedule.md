---
tags: 
    - java
    - schedule
    - timer
    - ScheduledExecutorService
title: Java에서 Schedule 사용하기
date: 2021/10/05
author: 김동환
description: Java Schedule (Timer, ScheduledExecutorService)
disabled: true
categories:
  - java
---

　
자바 어플리케이션에서 정기적으로 혹은 일회성 작업을 스케쥴링할 경우 `Timer` 클래스나 `ScheduledExecutorService`를 활용하여 thread-safe하게 사용할 수 있다.

# Timer

> 단일 스레드를 생성하여 각 `TimerTask`  작업대기열에 추가하여 수행한다. 기본적은 시간 단위는 milliseconds를 사용한다.
>

```java
public class Timer {

	private final TaskQueue queue = new TaskQueue();

	private final TimerThread thread = new TimerThread(queue);

}
```

## Method

`void schedule(TimerTask task, long delay)` : task를 delay 이후 실행한다.

`void schedule(TimerTask task, Date time)` : task를 time에 실행한다.

`void schedule(TimerTask task, long delay, long period)` : task를 delay 이후 매번 period 마다 실행한다. **fixed-delay**이므로, 절대적인 period가 아닌 성공적으로 task가 수행한 뒤 period가 적용된다.

`public void schedule(TimerTask task, Date firstTime, long period)` : task를 최초 firstTime에 실행하며, 매번 period 마다 task를 실행한다. **fixed-delay**이므로, 절대적인 period가 아닌 성공적으로 task가 수행한 뒤 period가 적용된다.

`void scheduleAtFixedRate(TimerTask task, long delay, long period)` : task를 delay 이후 매번 period 마다 실행한다. **fixed-rate**이므로, 이전 task와 상관없이 절대적인 period 시간에 따라 실행한다.

`void scheduleAtFixedRate(TimerTask task, Date firstTime, long period)` : task를 최초 firstTime에 실행하며, 매번 period 마다 task를 실행한다. **fixed-rate**이므로, 이전 task와 상관없이 절대적인 period 시간에 따라 실행한다.

## Example

```java
@Test
public void timerTest() {
	Timer timer = new Timer();
	AtomicInteger number = new AtomicInteger();
	TimerTask timerTask = new TimerTask() {
		@Override
		public void run() {
			log.info("#{}: {}", number.getAndIncrement(), new Date());
			try {
				Thread.sleep(2000);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
	};

	timer.schedule(timerTask, 1000, 1000);
	Thread.sleep(10000);
}

/*
14:29:52.936 [Timer-0] INFO lab.yearnlune.TimerTest - #0: Wed Oct 06 14:29:52 KST 2021
14:29:54.949 [Timer-0] INFO lab.yearnlune.TimerTest - #1: Wed Oct 06 14:29:54 KST 2021
14:29:56.950 [Timer-0] INFO lab.yearnlune.TimerTest - #2: Wed Oct 06 14:29:56 KST 2021
14:29:58.950 [Timer-0] INFO lab.yearnlune.TimerTest - #3: Wed Oct 06 14:29:58 KST 2021
14:30:00.951 [Timer-0] INFO lab.yearnlune.TimerTest - #4: Wed Oct 06 14:30:00 KST 2021
*/
```

## 주의점

1. 작업시간이 다수의 긴 Task를  돌릴 경우 원하는 기간에 작업을 수행하지 못한다.

단일 스레드로 큐잉된 작업들을 순차적으로 수행하므로, 다른 작업 수행시간에 영향을 받아 원하는 기간마다 수행하도록 설정해도 원하는 기간에 수행할 수 없다.

```java
@Test
public void 이전_작업이_긴_경우() throws Exception {
	Timer timer = new Timer();
	AtomicInteger totalSequence = new AtomicInteger(1);
	AtomicInteger aTaskSequence = new AtomicInteger(1);
	AtomicInteger bTaskSequence = new AtomicInteger(1);

	TimerTask aTask = new TimerTask() {
		@Override
		public void run() {
			log.info("#{} A-{} : {}", totalSequence.getAndIncrement(), aTaskSequence.getAndIncrement(), new Date());
			try {
				Thread.sleep(3000);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
	};

	TimerTask bTask = new TimerTask() {
		@Override
		public void run() {
			log.info("#{} B-{}: {}", totalSequence.getAndIncrement(), bTaskSequence.getAndIncrement(), new Date());
			try {
				Thread.sleep(1000);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
		}
	};

	timer.schedule(aTask, 0, 2000);
	timer.schedule(bTask, 0, 2000);
	Thread.sleep(30000);
}

/*
17:21:08.639 [Timer-0] INFO lab.yearnlune.TimerTest - #1 A-1
17:21:11.647 [Timer-0] INFO lab.yearnlune.TimerTest - #2 B-1
17:21:12.647 [Timer-0] INFO lab.yearnlune.TimerTest - #3 B-2
17:21:13.649 [Timer-0] INFO lab.yearnlune.TimerTest - #4 A-2
17:21:16.649 [Timer-0] INFO lab.yearnlune.TimerTest - #5 B-3
17:21:17.650 [Timer-0] INFO lab.yearnlune.TimerTest - #6 B-4
17:21:18.650 [Timer-0] INFO lab.yearnlune.TimerTest - #7 A-3
17:21:21.651 [Timer-0] INFO lab.yearnlune.TimerTest - #8 B-5
17:21:22.652 [Timer-0] INFO lab.yearnlune.TimerTest - #9 B-6
17:21:23.653 [Timer-0] INFO lab.yearnlune.TimerTest - #10 B-7
17:21:24.653 [Timer-0] INFO lab.yearnlune.TimerTest - #11 A-4
17:21:27.653 [Timer-0] INFO lab.yearnlune.TimerTest - #12 B-8
17:21:28.654 [Timer-0] INFO lab.yearnlune.TimerTest - #13 B-9
17:21:29.655 [Timer-0] INFO lab.yearnlune.TimerTest - #14 B-10
17:21:30.655 [Timer-0] INFO lab.yearnlune.TimerTest - #15 A-5
17:21:33.656 [Timer-0] INFO lab.yearnlune.TimerTest - #16 B-11
17:21:34.657 [Timer-0] INFO lab.yearnlune.TimerTest - #17 B-12
17:21:35.657 [Timer-0] INFO lab.yearnlune.TimerTest - #18 B-13
17:21:36.658 [Timer-0] INFO lab.yearnlune.TimerTest - #19 A-6
*/
```